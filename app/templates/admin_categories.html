{% extends 'admin_base.html' %}
{% block admin_content %}

<style>
    :root {
        --cream: #f5eee6;
        --beige: #e3c7a4;
        --brown: #6b4226;
        --darkbrown: #3d2313;
        --softbrown: #d6b18a;
        --danger: #b33a3a;
    }

    body {
        background: var(--cream);
    }

    /* PAGE TITLE */
    .page-title {
        text-align: center;
        font-weight: 800;
        font-size: 32px;
        color: var(--darkbrown);
        margin-bottom: 25px;
    }

    /* MAIN CARD */
    .page-card {
        width: 95%;
        max-width: 1300px;
        margin: auto;
        background: white;
        padding: 25px;
        border-radius: 16px;
        box-shadow: 0 6px 20px rgba(0,0,0,0.12);
    }

    /* ADD CATEGORY BUTTON */
    .add-btn {
        float: right;
        background: var(--brown);
        color: white;
        padding: 10px 20px;
        border-radius: 8px;
        font-weight: 600;
        text-decoration: none;
        transition: .2s;
        margin-bottom: 15px;
    }
    .add-btn:hover {
        background: var(--darkbrown);
    }

    /* TABLE STYLE */
    table {
        width: 100%;
        border-collapse: collapse;
    }

    thead {
        background: var(--brown);
        color: white;
    }

    th, td {
        padding: 15px;
        text-align: center;
        vertical-align: middle;
        font-size: 16px;
    }

    tbody tr {
        background: #fafafa;
        transition: .25s;
    }
    tbody tr:hover {
        background: #f2e8dd;
    }

    /* CATEGORY IMAGE */
    .category-img {
        width: 75px;
        height: 65px;
        border-radius: 8px;
        object-fit: cover;
        border: 1px solid #ddd;
    }

    /* EDIT BUTTON */
    .btn-edit {
        background: var(--softbrown);
        padding: 6px 16px;
        color: black;
        border-radius: 6px;
        text-decoration: none;
        font-weight: 600;
        margin-right: 8px;
    }
    .btn-edit:hover {
        background: var(--brown);
        color: white;
    }

    /* DELETE BUTTON */
    .btn-delete {
        background: var(--danger);
        padding: 6px 16px;
        color: white;
        border-radius: 6px;
        text-decoration: none;
        font-weight: 600;
    }
    .btn-delete:hover {
        background: #942d2d;
    }

    /* MODALS */
    .modal-header-add {
        background: var(--brown);
        color: white;
        padding: 12px 20px;
        border-radius: 12px 12px 0 0;
    }

    .modal-header-edit {
        background: var(--softbrown);
        padding: 12px 20px;
        border-radius: 12px 12px 0 0;
        color: black;
        font-weight: 700;
    }

    .btn-save {
        background: var(--brown);
        color: white;
        padding: 10px;
        border-radius: 8px;
        font-weight: 600;
        text-align: center;
        border: none;
        width: 100%;
    }

    .btn-save:hover {
        background: var(--darkbrown);
    }
</style>


<h2 class="page-title">All Categories</h2>

<div class="page-card">

    <!-- ADD CATEGORY BUTTON -->
    <a class="add-btn" data-bs-toggle="modal" data-bs-target="#addCategoryModal">+ Add Category</a>

    <!-- CATEGORY TABLE -->
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Image</th>
                <th>Name</th>
                <th>Actions</th>
            </tr>
        </thead>

        <tbody>
            {% for c in categories %}
            <tr>
                <td>{{ c.id }}</td>

                <td>
                    {% if c.image %}
                        <img src="{{ c.image.url }}" class="category-img">
                    {% else %}
                        <span style="color:#777;">No Image</span>
                    {% endif %}
                </td>

                <td style="font-weight:600;">{{ c.name }}</td>

                <td>
                    <a class="btn-edit" data-bs-toggle="modal" data-bs-target="#editCategoryModal{{ c.id }}">
                        Edit
                    </a>

                    <a href="{% url 'delete_category' c.id %}"
                       class="btn-delete"
                       onclick="return confirm('Delete this category?');">
                        Delete
                    </a>
                </td>
            </tr>

            <!-- EDIT MODAL -->
            <div class="modal fade" id="editCategoryModal{{ c.id }}" tabindex="-1">
              <div class="modal-dialog modal-dialog-centered" style="max-width:450px;">
                <div class="modal-content" style="border-radius:12px;">

                  <div class="modal-header-edit">
                      <h5 class="modal-title">Edit Category</h5>
                      <button class="btn-close" data-bs-dismiss="modal"></button>
                  </div>

                  <form action="{% url 'edit_category' c.id %}" method="POST" enctype="multipart/form-data">
                      {% csrf_token %}

                      <div class="modal-body">

                          <label>Name</label>
                          <input type="text" name="name" value="{{ c.name }}" class="form-control" required>

                          <label class="mt-3">Change Image (optional)</label>
                          <input type="file" name="image" class="form-control">

                      </div>

                      <div class="modal-footer">
                          <button class="btn-save">Save Changes</button>
                      </div>
                  </form>

                </div>
              </div>
            </div>

            {% endfor %}
        </tbody>
    </table>

</div>


<!-- ADD CATEGORY MODAL -->
<div class="modal fade" id="addCategoryModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered" style="max-width:450px;">
    <div class="modal-content" style="border-radius:12px;">

      <div class="modal-header-add">
        <h5 class="modal-title">Add New Category</h5>
        <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>

      <form action="{% url 'admin_categories' %}" method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        
        <div class="modal-body">

          <label>Name</label>
          <input type="text" name="name" class="form-control" required>

          <label class="mt-3">Category Image</label>
          <input type="file" name="image" class="form-control">

        </div>

        <div class="modal-footer">
          <button class="btn-save">Add Category</button>
        </div>

      </form>

    </div>
  </div>
</div>

{% endblock %}
